<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dentistwalla</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Local CSS -->
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="root"></div>

  <!-- React 18 CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Bootstrap JS bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- App Code -->
  <script type="text/babel">

    const { useState, useEffect, useRef } = React;

    /* ---------- Utilities ---------- */
    function haversineDistance(lat1, lon1, lat2, lon2) {
      // returns km (number)
      const R = 6371;
      const toRad = (v) => v * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return +(R * c).toFixed(2);
    }

    /* ---------- Header ---------- */
    function Header({ dark, toggleDark }) {
      return (
        <nav className={`navbar navbar-expand-lg ${dark ? 'navbar-dark bg-dark' : 'navbar-light bg-light'}`}>
          <div className="container-fluid">
            <a className="navbar-brand" href="#"> Dentistwalla</a>

            <div className="d-flex align-items-center">
              <button id="locBtn" className="btn btn-outline-primary btn-sm me-2">Use my location</button>

              <div className="form-check form-switch">
                <input className="form-check-input" type="checkbox" id="darkSwitch" checked={dark} onChange={toggleDark}/>
                <label className="form-check-label" htmlFor="darkSwitch">Dark</label>
              </div>
            </div>
          </div>
        </nav>
      );
    }

    /* ---------- Controls ---------- */
    function Controls({
      search, setSearch,
      minRating, setMinRating,
      mealFilter, setMealFilter,
      maxDistance, setMaxDistance,
      sortBy, setSortBy,
      resetFilters
    }) {
      return (
        <div className="card mb-3">
          <div className="card-body">
            <div className="row g-2 align-items-center">
                <div className="col-12 col-md-4 position-relative">
  <input
    className="form-control pe-5"
    placeholder="Search Clinic/Area/Treatment..."
    value={search}
    onChange={(e) => setSearch(e.target.value)}
  />
<div id="servicesCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">

    <!-- Slide 1 -->
    <div class="carousel-item active text-center p-5">
      <h2>Current Services</h2>
      <div class="d-flex justify-content-center gap-4 mt-4">

        <!-- SVG service 1 -->
        <div>
          <svg width="50" height="50" fill="currentColor" class="bi bi-gear">
            <use xlink:href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/bootstrap-icons.svg#gear"></use>
          </svg>
          <p>Service A</p>
        </div>

        <!-- SVG service 2 -->
        <div>
          <svg width="50" height="50" fill="currentColor" class="bi bi-lightning-fill">
            <use xlink:href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/bootstrap-icons.svg#lightning-fill"></use>
          </svg>
          <p>Service B</p>
        </div>

      </div>
    </div>

    <!-- Slide 2 -->
    <div class="carousel-item text-center p-5">
      <h2>Upcoming Services</h2>
      <div class="d-flex justify-content-center gap-4 mt-4">

        <!-- Future icon -->
        <div>
          <svg width="50" height="50" fill="currentColor" class="bi bi-rocket-fill">
            <use xlink:href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/bootstrap-icons.svg#rocket-fill"></use>
          </svg>
          <p>Coming Soon</p>
        </div>

        <div>
          <svg width="50" height="50" fill="currentColor" class="bi bi-stars">
            <use xlink:href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/bootstrap-icons.svg#stars"></use>
          </svg>
          <p>New Feature</p>
        </div>
      </div>
    </div>

  </div>

  <!-- Controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#servicesCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#servicesCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>

</div>

  {search && (
    <button
      className="btn btn-sm btn-link text-secondary position-absolute end-0 top-50 translate-middle-y me-2 p-0"
      onClick={resetFilters}
      style={{ textDecoration: "none" }}
    >
      ‚úñ
    </button>
  )}
</div>


            {/*  <div className="col-6 col-md-2">
                <select className="form-select" value={minRating} onChange={(e) => setMinRating(e.target.value)}>
                  <option value="">Rating any</option>
                  <option value="4">4.0+</option>
                  <option value="4.5">4.5+</option>
                </select>
              </div>

              <div className="col-6 col-md-2">
                <select className="form-select" value={mealFilter} onChange={(e) => setMealFilter(e.target.value)}>
                  <option value="">All Treatments</option>
                  <option>Dental Check-up</option>
<option>Teeth Cleaning / Scaling</option>
<option>Tooth Filling</option>
<option>Root Canal Treatment</option>
<option>Crown & Bridge</option>
<option>Tooth Extraction</option>
<option>Wisdom Tooth Removal</option>
<option>Dental Implants</option>
<option>Dentures</option>
<option>Braces</option>
                </select>
              </div>

              <div className="col-6 col-md-2">
                <select className="form-select" value={sortBy} onChange={(e) => setSortBy(e.target.value)}>
                  <option value="best">Sort: Best match</option>
                  <option value="rating">Sort: Rating ‚Üì</option>
                  <option value="distance">Sort: Distance ‚Üë</option>
                  <option value="name">Sort: Name A‚ÜíZ</option>
                </select>
              </div>
*/}
      {/*        <div className="col-6 col-md-2 text-end">
                <button className="btn btn-sm btn-outline-secondary" onClick={resetFilters}>Reset</button>
              </div>
      */}        
{/*
              <div className="col-12 mt-3">
                <label className="form-label">Max distance: <strong>{maxDistance} km</strong></label>
                <input type="range" min="1" max="50" value={maxDistance}
                  className="form-range" onChange={(e) => setMaxDistance(Number(e.target.value))} />
              </div>
*/}
            </div>
          </div>
        </div>
      );
    }

    /* ---------- Clinic Card & Modal Trigger ---------- */
    function ClinicCard({ r, onOpen }) {
      return (
        <div className="card mb-3 shadow-sm">
          <div className="row g-0">
            <div className="col-4">
              <img src={r.img || 'https://via.placeholder.com/300x200?text=No+Image'} className="img-fluid rounded-start" alt={r.name}/>
            </div>
            <div className="col-8">
              <div className="card-body">
                <h5 className="card-title mb-1">{r.name}</h5>
                <p className="mb-1"><small className="text-muted">{r.speciality}</small></p>
                <p className="mb-1">‚≠ê {r.rating} ¬∑ {r.priceLevel} ¬∑ {r.treatmentTypes.join(', ')}</p>
                <p className="mb-1">Distance: <strong>{r.distance != null ? r.distance + ' km' : '‚Äî'}</strong></p>
                <div>
                  <button className="btn btn-sm btn-primary me-2" onClick={() => onOpen(r)}>Details</button>
                  <a className="btn btn-outline-secondary btn-sm" target="_blank" rel="noreferrer"
                     href={`https://www.google.com/maps/dir/?api=1&destination=${r.lat},${r.lng}`}>Navigate</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    /* ---------- Map Component (Leaflet) ---------- */
    function MapView({ Clinics, userLocation, highlightId }) {
      const mapRef = useRef(null);
      const markersRef = useRef(null);

      useEffect(() => {
        if (!mapRef.current) {
          mapRef.current = L.map('map', { center: [25.61, 85.15], zoom: 13, scrollWheelZoom: false });
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(mapRef.current);
          markersRef.current = L.layerGroup().addTo(mapRef.current);
        }
      }, []);

      useEffect(() => {
        if (!mapRef.current || !markersRef.current) return;

        markersRef.current.clearLayers();
        const bounds = [];

        Clinics.forEach(r => {
          if (!r.lat || !r.lng) return;
          const marker = L.marker([r.lat, r.lng]);
          marker.bindPopup(`<strong>${r.name}</strong><br/>‚≠ê ${r.rating} ¬∑ ${r.priceLevel}<br/>${r.distance ?? '‚Äî'} km`);
          markersRef.current.addLayer(marker);
          bounds.push([r.lat, r.lng]);
        });

        if (userLocation) {
          const userMarker = L.circleMarker([userLocation.lat, userLocation.lng], { radius: 6, color: 'blue' });
          userMarker.bindPopup('You are here');
          markersRef.current.addLayer(userMarker);
          bounds.push([userLocation.lat, userLocation.lng]);
        }

        if (bounds.length > 0) {
          mapRef.current.fitBounds(bounds, { padding: [40, 40], maxZoom: 15 });
        }
      }, [Clinics, userLocation, highlightId]);

      return <div id="map" style={{ height: '320px', width: '100%' }} className="rounded"></div>;
    }

    /* ---------- Modal (Bootstrap) ---------- */
    function DetailsModal() {
      // Bootstrap modal is controlled via data attributes / JS.
      return (
        <div className="modal fade" id="detailsModal" tabIndex="-1" aria-hidden="true">
          <div className="modal-dialog modal-lg">
            <div className="modal-content">
              <div className="modal-header">
                <h5 className="modal-title" id="detailsTitle">Details</h5>
                <button type="button" className="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div className="modal-body" id="detailsBody">
                {/* Content injected dynamically */}
              </div>
            </div>
          </div>
        </div>
      );
    }

    /* ---------- Main App ---------- */
    
    function App() {
      const [fabOpen, setFabOpen] = useState(false);
      const [Clinics, setClinics] = useState([]);
      const [search, setSearch] = useState('');
      const [minRating, setMinRating] = useState('');
      const [mealFilter, setMealFilter] = useState('');
      const [maxDistance, setMaxDistance] = useState(10);
      const [sortBy, setSortBy] = useState('best');
      const [userLocation, setUserLocation] = useState(null);
      const [dark, setDark] = useState(false);
      const [highlightId, setHighlightId] = useState(null);

      // Load JSON
      useEffect(() => {
        fetch('./clinics.json')
          .then(res => {
            if (!res.ok) throw new Error('Failed to load Clinics.json');
            return res.json();
          })
          .then(data => {
            // ensure numeric types
            const norm = data.map(r => ({ ...r, rating: Number(r.rating) }));
            setClinics(norm);
          })
          .catch(err => {
            console.error(err);
            alert('Could not load Clinics.json ‚Äî check console.');
          });
      }, []);

      // Attach location button handler (outside React tree)
      useEffect(() => {
        const btn = document.getElementById('locBtn');
        if (!btn) return;
        const handler = () => {
          if (!navigator.geolocation) {
            alert('Geolocation not supported by your browser.');
            return;
          }
          btn.disabled = true;
          btn.innerText = 'Locating...';
          navigator.geolocation.getCurrentPosition((pos) => {
            const lat =19;// pos.coords.latitude;
            const lng =72;// pos.coords.longitude;
            setUserLocation({ lat, lng });
            btn.innerText = 'Location set';
            btn.disabled = false;
            // compute distances
            setClinics(prev =>
              prev.map(r => ({ ...r, distance: haversineDistance(lat, lng, r.lat, r.lng) }))
            );
          }, (err) => {
            console.warn('Geolocation error', err);
            alert('Unable to retrieve your location.');
            btn.disabled = false;
            btn.innerText = 'Use my location';
          }, { enableHighAccuracy: true, timeout: 10000 });
        };
        btn.addEventListener('click', handler);
        return () => btn.removeEventListener('click', handler);
      }, []);

      // Dark mode switch
      useEffect(() => {
        document.body.classList.toggle('dark-mode', dark);
      }, [dark]);

      // Filtering pipeline
      const filtered = Clinics
        .filter(r => r.name.toLowerCase().includes(search.toLowerCase()) || (r.speciality && r.speciality.toLowerCase().includes(search.toLowerCase())))
        .filter(r => minRating ? r.rating >= Number(minRating) : true)
        .filter(r => mealFilter ? r.treatmentTypes.includes(mealFilter) : true)
        .filter(r => (r.distance != null) ? r.distance <= maxDistance : true);

      // Sorting
      const sorted = [...filtered].sort((a, b) => {
        if (sortBy === 'rating') return b.rating - a.rating;
        if (sortBy === 'distance') {
          const da = a.distance ?? 9999;
          const db = b.distance ?? 9999;
          return da - db;
        }
        if (sortBy === 'name') return a.name.localeCompare(b.name);
        // best: rating desc then distance asc
        return (b.rating - a.rating) || ((a.distance ?? 9999) - (b.distance ?? 9999));
      });

      function resetFilters() {
        setSearch('');
        setMinRating('');
        setMealFilter('');
        setMaxDistance(10);
        setSortBy('best');
      }

      // Open details modal
      function openDetails(r) {
        setHighlightId(r.id);
        // Update modal content
        const title = document.getElementById('detailsTitle');
        const body = document.getElementById('detailsBody');
        title.innerText = r.name;
        body.innerHTML = `
          <div class="row">
            <div class="col-md-5">
              <img src="${r.img || 'https://via.placeholder.com/600x400?text=No+Image'}" class="img-fluid rounded mb-2" />
              <p><strong>Address:</strong> ${r.address || 'N/A'}</p>
              <p><strong>Contact:</strong> ${r.phone || 'N/A'}</p>
            </div>
            <div class="col-md-7">
              <p><strong>Rating:</strong> ‚≠ê ${r.rating}</p>
              <p><strong>Price:</strong> ${r.priceLevel}</p>
              <p><strong>Treatments:</strong> ${r.treatmentTypes.join(', ')}</p>
              <p><strong>Speciality:</strong> ${r.speciality || '‚Äî'}</p>
              <p><strong>Distance:</strong> ${r.distance != null ? r.distance + ' km' : '‚Äî'}</p>
              <p>${r.description || ''}</p>
              <a class="btn btn-primary" target="_blank" rel="noreferrer"
                 href="https://www.google.com/maps/dir/?api=1&destination=${r.lat},${r.lng}">Open in Maps</a>
            </div>
          </div>
        `;
        const modalEl = document.getElementById('detailsModal');
        const bsModal = new bootstrap.Modal(modalEl, {});
        bsModal.show();
      }

      function openInfo(title, content) {
  document.getElementById("infoModalTitle").innerText = title;
  document.getElementById("infoModalBody").innerHTML = content;

  const modalEl = document.getElementById("infoModal");
  const modal = new bootstrap.Modal(modalEl);
  modal.show();
}


      return (
        <div>
          <Header dark={dark} toggleDark={() => setDark(d => !d)} />

          <div className="container my-3">
            <Controls
              search={search} setSearch={setSearch}
              minRating={minRating} setMinRating={setMinRating}
              mealFilter={mealFilter} setMealFilter={setMealFilter}
              maxDistance={maxDistance} setMaxDistance={setMaxDistance}
              sortBy={sortBy} setSortBy={setSortBy}
              resetFilters={resetFilters}
            />

            <div className="row">
              <div className="col-md-6">
                <h5 className="mb-3">Results ({sorted.length})</h5>
                {sorted.length === 0 && <div className="alert alert-warning">No Clinics match current filters.</div>}
                {sorted.map(r => (
                  <div key={r.id}>
                    <ClinicCard r={r} onOpen={openDetails}/>
                  </div>
                ))}
              </div>

        {/*     <div className="col-md-6">
                <h5 className="mb-3">Map</h5>
                <MapView Clinics={sorted} userLocation={userLocation} highlightId={highlightId} />
              </div>
        */}       
            </div>
          </div>
          <div className={`fab-wrapper ${fabOpen ? 'open' : ''}`}>
  <button className="fab-main" onClick={() => setFabOpen(o => !o)}>
    {fabOpen ? "‚úñ" : "‚ò∞"}
  </button>

  <div className="fab-menu">
    <button
  className="fab-item"
  onClick={() => {
    setFabOpen(false);
    openInfo(
      "About Us",
      `<h5>Who We Are</h5>
      <p>
        Dentistwalla is an aggregator platform dedicated to connecting patients with 
        trusted, pocket-friendly dental clinics. We believe quality dental care should 
        be accessible to everyone ‚Äî not just the top 5% of the population.
      </p>

      <p>
        Our mission is to increase footfall for clinics offering affordable, 
        ethical, and reliable treatments, while ensuring patients receive the care 
        they deserve without financial burden.
      </p>

      <hr>

      <h5>Our Vision</h5>
      <p>
        To become India‚Äôs most trusted dental access platform by empowering clinics 
        and enabling mass-population dental healthcare.
      </p>

      <hr>

      <h5>Founders</h5>
      <ul>
        <li><strong>Dr. Areeb Asad</strong></li>
        <li><strong>S. Reyaz</strong></li>
      </ul>`
    );
  }}
>
  ‚Ñπ About Us
</button>

<button
  className="fab-item"
  onClick={() => {
    setFabOpen(false);
    openInfo(
      "Contact Us",
      `<h5>Get in Touch</h5>

      <p>You can reach out to us anytime for partnerships, support, or general queries.</p>

      <hr>

      <h6>Email</h6>
      <ul>
        <li><a href="mailto:asadareeb2016@gmail.com">asadareeb2016@gmail.com</a></li>
        <li><a href="mailto:shaheensciencesociety2021@gmail.com">shaheensciencesociety2021@gmail.com</a></li>
      </ul>

      <h6>Phone</h6>
      <p>
        <a href="tel:+918126466014">+91 8126466014</a>
      </p>`
    );
  }}
>
  üìû Contact
</button>


    <button className="fab-item" onClick={() => alert('Treatments')}>ü¶∑ Treatments</button>
    <button className="fab-item" onClick={() => alert('Paid Intership')}>ü¶∑ Paid Internship</button>
  </div>
</div>

          <DetailsModal />
          <div class="modal fade" id="infoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="infoModalBody"></div>
    </div>
  </div>
</div>

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
